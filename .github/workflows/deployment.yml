name: Deploy Freelance website

on:
    push:
        branches:
            - 'main'

env:
    PROJECT_ID: freelance

jobs:
    setup-build-deploy:
        name: Setup, Build, and Deploy
        runs-on: ubuntu-18.04

        steps:
            - uses: actions/checkout@v2

            # https://github.com/marketplace/actions/version-check
            - name: Check package version
              uses: EndBug/version-check@v1
              id: check

            - name: Get Package Version
              id: get_version
              run: echo "package version - ${{ steps.check.outputs.version }} (${{ steps.check.outputs.type }})"

            - name: Build
              run: |-
                  yarn install && yarn build && yarn export

            - name: Publish
              uses: cloudflare/wrangler-action@1.3.0
              with:
                  apiToken: ${{ secrets.CF_API_TOKEN }}
